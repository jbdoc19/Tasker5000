<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task Focus Workflow</title>
  <style>
    :root {
      --hero-teal: #2dd4c3;
      --hero-teal-dark: #1fb3a5;
      --bg: #0d1117;
      --surface: rgba(18, 23, 30, 0.92);
      --surface-muted: rgba(16, 20, 27, 0.82);
      --surface-soft: rgba(20, 27, 36, 0.65);
      --surface-neutral: rgba(26, 31, 40, 0.58);
      --text-primary: #f6fbff;
      --text-secondary: #94a3b8;
      --text-muted: #6b7280;
      --border: rgba(148, 163, 184, 0.2);
      --border-subtle: rgba(148, 163, 184, 0.14);
      --card-radius: 18px;
      --header-height: 76px;
      --transition: 180ms ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", "SF Pro Display", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at 20% 20%, rgba(45, 212, 195, 0.12), transparent 52%),
        radial-gradient(circle at 80% -10%, rgba(59, 130, 246, 0.12), transparent 40%), var(--bg);
      color: var(--text-primary);
      min-height: 100vh;
      padding-bottom: 180px;
    }

    h1,
    h2,
    h3 {
      font-weight: 600;
      letter-spacing: -0.015em;
      margin: 0 0 0.35rem;
    }

    h4,
    h5,
    h6 {
      font-weight: 500;
      letter-spacing: -0.01em;
      margin: 0 0 0.35rem;
    }

    p {
      margin: 0 0 0.75rem;
      color: var(--text-secondary);
      max-width: 60ch;
    }

    a {
      color: var(--hero-teal);
    }

    button {
      font-family: inherit;
      border: none;
      cursor: pointer;
      border-radius: 14px;
      transition: all var(--transition);
    }

    .app-shell {
      max-width: 1180px;
      margin: 0 auto;
      padding: calc(var(--header-height) + 2rem) 1.5rem 3rem;
      display: flex;
      flex-direction: column;
      gap: 3rem;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      background: rgba(11, 15, 22, 0.82);
      backdrop-filter: blur(18px);
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 60;
    }

    .header-inner {
      width: min(1180px, calc(100% - 2.5rem));
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      font-size: 1.1rem;
      color: var(--text-primary);
    }

    .brand-icon {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: linear-gradient(140deg, rgba(45, 212, 195, 0.72), rgba(59, 130, 246, 0.48));
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #021d1a;
      font-weight: 700;
    }

    .stage-nav {
      display: flex;
      gap: 0.5rem;
      flex: 1;
      justify-content: center;
    }

    .stage-nav button {
      background: transparent;
      border: 1px solid transparent;
      color: var(--text-secondary);
      font-size: 0.92rem;
      padding: 0.55rem 1.1rem;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .stage-nav button.active {
      color: var(--text-primary);
      border-color: rgba(148, 163, 184, 0.32);
      background: rgba(148, 163, 184, 0.14);
    }

    .stage-nav button span {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      font-size: 0.75rem;
    }

    .stage {
      display: flex;
      flex-direction: column;
      gap: 1.75rem;
    }

    .stage-heading {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .stage-heading h2 {
      font-size: 1.6rem;
    }

    .stage-heading p {
      margin: 0;
    }

    .stage-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background: var(--surface);
      border-radius: var(--card-radius);
      border: 1px solid var(--border);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.85rem;
      box-shadow: 0 30px 60px -40px rgba(15, 23, 42, 0.8);
    }

    .card.muted {
      background: var(--surface-muted);
    }

    .card.soft {
      background: var(--surface-soft);
    }

    .card.neutral {
      background: var(--surface-neutral);
      border-color: transparent;
    }

    .card hero-title {
      display: block;
      font-size: 1.25rem;
      font-weight: 600;
    }

    .card-divider {
      width: 100%;
      height: 1px;
      background: var(--border-subtle);
      margin: 0.5rem 0;
    }

    .hero-cta {
      background: var(--hero-teal);
      color: #052321;
      font-weight: 600;
      padding: 0.75rem 1.4rem;
      border-radius: 12px;
      box-shadow: 0 18px 40px rgba(45, 212, 195, 0.28);
    }

    .hero-cta:hover {
      background: var(--hero-teal-dark);
    }

    .subtle-btn {
      background: rgba(148, 163, 184, 0.16);
      color: var(--text-primary);
      padding: 0.55rem 1rem;
      border-radius: 999px;
      font-size: 0.9rem;
    }

    .subtle-btn:hover {
      background: rgba(148, 163, 184, 0.24);
    }

    .quick-partners {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .partner-rail {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      flex-wrap: wrap;
    }

    .partner-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.55);
      color: var(--text-primary);
      font-size: 0.85rem;
      opacity: 0;
      transform: translateY(-6px);
      pointer-events: none;
      transition: all var(--transition);
    }

    .partner-chip.visible {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .partner-chip .icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #041015;
    }

    .partner-primary {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      justify-content: space-between;
      background: rgba(45, 212, 195, 0.16);
      border-radius: 14px;
      padding: 0.65rem 0.85rem;
      border: 1px solid rgba(45, 212, 195, 0.38);
    }

    .partner-primary button {
      background: var(--hero-teal);
      color: #04211f;
      padding: 0.45rem 1rem;
      border-radius: 12px;
      font-weight: 600;
    }

    .toggle-partner {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .toggle-partner svg {
      transition: transform var(--transition);
    }

    .toggle-partner.open svg {
      transform: rotate(180deg);
    }

    .focus-hud {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 1.75rem;
    }

    .focus-card {
      display: grid;
      gap: 1.5rem;
      background: linear-gradient(130deg, rgba(45, 212, 195, 0.1), rgba(15, 23, 42, 0.8));
      padding: 2rem;
      border-radius: 24px;
      border: 1px solid rgba(45, 212, 195, 0.2);
      position: relative;
    }

    .focus-card header {
      position: static;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      background: none;
      border: none;
      padding: 0;
    }

    .focus-card header h3 {
      font-size: 1.55rem;
    }

    .hud-body {
      display: grid;
      gap: 1.5rem;
    }

    .slider-pair {
      display: grid;
      gap: 0.75rem;
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .slider-row label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      width: 90px;
    }

    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 4px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.16);
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--hero-teal);
      border: 2px solid #051b19;
      box-shadow: 0 4px 14px rgba(45, 212, 195, 0.3);
      cursor: pointer;
    }

    .recommendation {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .recommendation h4 {
      font-size: 1.1rem;
    }

    .hud-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .hud-drawer-toggle {
      background: rgba(148, 163, 184, 0.16);
      color: var(--text-primary);
      padding: 0.6rem 1rem;
      border-radius: 12px;
    }

    .hud-drawer {
      position: absolute;
      top: 2rem;
      right: 2rem;
      width: 240px;
      background: rgba(9, 14, 20, 0.88);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.24);
      padding: 1rem;
      display: grid;
      gap: 0.75rem;
      transform: translateX(16px);
      opacity: 0;
      pointer-events: none;
      transition: all var(--transition);
    }

    .hud-drawer.open {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }

    .drawer-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .chip {
      background: rgba(148, 163, 184, 0.2);
      color: var(--text-primary);
      font-size: 0.75rem;
      padding: 0.3rem 0.75rem;
      border-radius: 999px;
    }

    .list {
      display: grid;
      gap: 0.75rem;
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      background: rgba(148, 163, 184, 0.12);
      border-radius: 14px;
      padding: 0.85rem 1rem;
    }

    .list-item strong {
      color: var(--text-primary);
    }

    .wrap-card {
      display: grid;
      gap: 0.85rem;
    }

    .wrap-inputs {
      display: grid;
      gap: 0.65rem;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      background: rgba(8, 12, 20, 0.9);
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      padding: 0.85rem 1rem;
      color: var(--text-primary);
      font-family: inherit;
      resize: vertical;
    }

    select {
      background: rgba(8, 12, 20, 0.9);
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      color: var(--text-primary);
      padding: 0.65rem 0.9rem;
    }

    .quick-capture {
      position: fixed;
      bottom: 2.5rem;
      right: 2.5rem;
      background: rgba(8, 12, 20, 0.92);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 40px 70px -40px rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      gap: 0.85rem;
      padding: 0.85rem 1rem;
      min-width: 260px;
      z-index: 70;
    }

    .quick-capture input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 0.95rem;
      outline: none;
    }

    .quick-capture button {
      background: var(--hero-teal);
      color: #052321;
      border-radius: 12px;
      padding: 0.45rem 0.85rem;
      font-weight: 600;
    }

    .quick-capture .expand {
      background: rgba(148, 163, 184, 0.16);
      color: var(--text-primary);
      padding: 0.45rem;
      border-radius: 12px;
      width: 38px;
      height: 38px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(3, 6, 12, 0.72);
      backdrop-filter: blur(22px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 120;
      padding: 1.5rem;
    }

    .modal-backdrop.open {
      display: flex;
    }

    .modal-card {
      background: rgba(12, 18, 27, 0.95);
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      max-width: 420px;
      width: 100%;
      padding: 2rem;
      display: grid;
      gap: 1.5rem;
    }

    .stepper {
      display: flex;
      gap: 0.35rem;
    }

    .stepper span {
      width: 26px;
      height: 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.2);
      transition: background var(--transition);
    }

    .stepper span.active {
      background: var(--hero-teal);
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
    }

    .modal-actions button {
      flex: 1;
      padding: 0.65rem 1rem;
      border-radius: 12px;
      font-weight: 600;
    }

    .modal-actions .secondary {
      background: rgba(148, 163, 184, 0.16);
      color: var(--text-primary);
    }

    .modal-actions .secondary:hover {
      background: rgba(148, 163, 184, 0.24);
    }

    .modal-actions .primary {
      background: var(--hero-teal);
      color: #042321;
    }

    .grounding-footer {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      width: min(1180px, 100%);
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      background: rgba(8, 12, 18, 0.92);
      border-top: 1px solid rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(18px);
      z-index: 90;
    }

    .grounding-footer.pulse {
      box-shadow: 0 0 0 3px rgba(45, 212, 195, 0.25);
    }

    .grounding-footer button {
      background: rgba(148, 163, 184, 0.16);
      color: var(--text-primary);
      padding: 0.55rem 0.85rem;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 0.85rem;
    }

    .grounding-footer button.hero {
      background: var(--hero-teal);
      color: #041f1c;
      font-weight: 600;
    }

    .meltdown-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(3, 7, 18, 0.78);
      backdrop-filter: blur(24px);
      z-index: 130;
      padding: 1.5rem;
    }

    .meltdown-overlay.open {
      display: flex;
    }

    .meltdown-card {
      background: rgba(13, 20, 28, 0.98);
      border-radius: 24px;
      border: 1px solid rgba(45, 212, 195, 0.32);
      padding: 2.5rem 2rem;
      width: min(420px, 100%);
      display: grid;
      gap: 1.4rem;
      text-align: center;
    }

    .meltdown-card h3 {
      font-size: 1.5rem;
    }

    .meltdown-steps {
      display: grid;
      gap: 0.85rem;
      text-align: left;
    }

    .meltdown-steps li {
      background: rgba(45, 212, 195, 0.12);
      border-radius: 16px;
      border: 1px solid rgba(45, 212, 195, 0.24);
      padding: 0.85rem 1rem;
      list-style: none;
    }

    .toast {
      position: fixed;
      top: calc(var(--header-height) + 1rem);
      right: 1.5rem;
      background: rgba(45, 212, 195, 0.16);
      color: var(--text-primary);
      padding: 0.75rem 1.2rem;
      border-radius: 14px;
      border: 1px solid rgba(45, 212, 195, 0.24);
      display: none;
      z-index: 200;
    }

    .toast.show {
      display: block;
    }

    @media (max-width: 960px) {
      .app-shell {
        padding: calc(var(--header-height) + 1.5rem) 1.25rem 4rem;
      }

      .focus-card {
        padding: 1.5rem;
      }

      .hud-drawer {
        position: static;
        width: auto;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        transform: none;
        opacity: 1;
        pointer-events: auto;
        background: rgba(8, 12, 20, 0.9);
      }
    }

    @media (max-width: 720px) {
      header {
        height: auto;
        padding: 0.85rem 0;
      }

      .header-inner {
        flex-direction: column;
        align-items: stretch;
        width: calc(100% - 2rem);
      }

      .stage-nav {
        justify-content: flex-start;
        overflow-x: auto;
        padding-bottom: 0.35rem;
      }

      .app-shell {
        padding-top: 9rem;
      }

      .quick-capture {
        right: 1.25rem;
        left: 1.25rem;
        bottom: 1.5rem;
        min-width: 0;
      }

      .grounding-footer {
        flex-wrap: wrap;
        justify-content: center;
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand"><span class="brand-icon">TF</span> Task Focus Protocol</div>
      <nav class="stage-nav" aria-label="Workflow stages">
        <button class="stage-tab active" data-target="prime"><span>1</span> Prime</button>
        <button class="stage-tab" data-target="plan"><span>2</span> Plan</button>
        <button class="stage-tab" data-target="execute"><span>3</span> Execute</button>
        <button class="stage-tab" data-target="wrap"><span>4</span> Wrap</button>
      </nav>
      <div class="session-clock" aria-live="polite">Current block: <strong>09:45–11:15</strong></div>
    </div>
  </header>

  <div class="app-shell">
    <section class="stage" id="prime">
      <div class="stage-heading">
        <div>
          <h2>Prime</h2>
          <p>Ground yourself, check your sensory supports, and call in allies before you go heads-down.</p>
        </div>
        <button class="subtle-btn" data-open="grounding">Grounding footer →</button>
      </div>
      <div class="stage-grid">
        <article class="card muted">
          <h3>Grounding Status</h3>
          <p>Meltdown Shield and sensory toggles live in the footer for crisis-proof access. Preview their current state here.</p>
          <div class="list">
            <div class="list-item">
              <div>
                <strong>Meltdown Shield</strong>
                <p>Ready to deploy · calming script queued</p>
              </div>
              <button class="hero-cta" data-open="meltdown">Launch</button>
            </div>
            <div class="list-item">
              <div>
                <strong>Sensory Safety</strong>
                <p>Noise filtered · lighting set to amber · texture kit packed</p>
              </div>
              <button class="subtle-btn" data-open="grounding">Adjust</button>
            </div>
          </div>
        </article>

        <article class="card neutral quick-partners">
          <header class="partner-primary">
            <div>
              <h3>Planning Ally</h3>
              <p>A quick consult away if decision fatigue spikes.</p>
            </div>
            <button>Ping Jamie</button>
          </header>
          <div class="card-divider"></div>
          <div class="partner-rail" aria-expanded="false">
            <button class="partner-chip" data-color="#c084fc">
              <span class="icon" style="background:#c084fc">T</span> Therapist
            </button>
            <button class="partner-chip" data-color="#fb7185">
              <span class="icon" style="background:#fb7185">C</span> Co-regulate
            </button>
            <button class="partner-chip" data-color="#f97316">
              <span class="icon" style="background:#f97316">A</span> Admin Wing
            </button>
            <button class="partner-chip" data-color="#facc15">
              <span class="icon" style="background:#facc15">R</span> Rapid Notes
            </button>
            <button class="partner-chip" data-color="#38bdf8">
              <span class="icon" style="background:#38bdf8">S</span> Scribe Buddy
            </button>
          </div>
          <button class="toggle-partner" aria-controls="partner-rail">
            <span>Show reassurance crew</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
          </button>
        </article>

        <article class="card soft">
          <h3>Prime Checklist</h3>
          <p>Take 90 seconds to transition out of previous context and preview what’s next.</p>
          <ul class="list">
            <li class="list-item">
              <span>Reset nervous system</span>
              <span class="chip">3 breaths</span>
            </li>
            <li class="list-item">
              <span>Skim mission of the day</span>
              <span class="chip">1 minute</span>
            </li>
            <li class="list-item">
              <span>Confirm buffer before next client</span>
              <span class="chip">15 min</span>
            </li>
          </ul>
        </article>
      </div>
    </section>

    <section class="stage" id="plan">
      <div class="stage-heading">
        <div>
          <h2>Plan</h2>
          <p>Capture inputs, calibrate expectations, and tee up a confident starting point.</p>
        </div>
        <button class="hero-cta">Calibrate day</button>
      </div>
      <div class="stage-grid">
        <article class="card soft">
          <h3>Next Best Inputs</h3>
          <p>Energy-aware prompts set your targets. Adjust if you’ve already crushed a few wins.</p>
          <div class="list">
            <div class="list-item">
              <div>
                <strong>Client Follow-ups</strong>
                <p>Send recap notes for morning sessions.</p>
              </div>
              <span class="chip">20 min</span>
            </div>
            <div class="list-item">
              <div>
                <strong>Prep Tomorrow</strong>
                <p>Skim diagnostic updates · flag blockers.</p>
              </div>
              <span class="chip">15 min</span>
            </div>
          </div>
          <button class="subtle-btn" data-open="hud-drawer">Adjust inputs</button>
        </article>

        <article class="card neutral">
          <h3>Due Today</h3>
          <p>Only the essentials. Everything else lives in Upcoming.</p>
          <ul class="list">
            <li class="list-item">
              <div>
                <strong>Insurance report draft</strong>
                <p>Waiting on vitals from PA team</p>
              </div>
              <span class="chip">Due 2:00p</span>
            </li>
            <li class="list-item">
              <div>
                <strong>Call Alex’s guardian</strong>
                <p>Confirm handoff to respite</p>
              </div>
              <span class="chip">12:30p</span>
            </li>
          </ul>
        </article>

        <article class="card muted">
          <h3>Day Brief</h3>
          <p>What’s your vibe? Name it before the work starts.</p>
          <select>
            <option>Feeling steady · ready for focused push</option>
            <option>A little scattered · need extra scaffolding</option>
            <option>Running hot · schedule decompression</option>
          </select>
          <textarea placeholder="Note any constraints that might change your plan"></textarea>
        </article>
      </div>
    </section>

    <section class="stage" id="execute">
      <div class="stage-heading">
        <div>
          <h2>Execute</h2>
          <p>Everything you need to start, sustain, or extend a session is in one Focus HUD.</p>
        </div>
        <button class="subtle-btn" data-open="hud-drawer">Open drawer</button>
      </div>
      <div class="focus-hud">
        <article class="focus-card">
          <header>
            <h3>Focus HUD</h3>
            <p>Activation sliders feed directly into your next best move. When ready, hit start to drop in.</p>
          </header>
          <div class="hud-body">
            <div class="slider-pair">
              <div class="slider-row">
                <label for="energy-slider">Energy</label>
                <input id="energy-slider" type="range" min="0" max="10" value="7" />
                <span class="chip" id="energy-value">7/10</span>
              </div>
              <div class="slider-row">
                <label for="time-slider">Time on deck</label>
                <input id="time-slider" type="range" min="0" max="10" value="5" />
                <span class="chip" id="time-value">45 min</span>
              </div>
            </div>
            <div class="recommendation">
              <span class="chip">Top recommendation</span>
              <h4 id="hud-recommendation">Prep tomorrow’s safety plans</h4>
              <p id="hud-context">Your energy is trending solid and you have 45 minutes clear—lean into proactive work while momentum is high.</p>
            </div>
            <div class="hud-actions">
              <button class="hero-cta" id="start-focus">Start focus block</button>
              <button class="hud-drawer-toggle" aria-expanded="false">More controls</button>
              <div class="hud-drawer" aria-hidden="true">
                <button class="subtle-btn" id="refresh-hud">Refresh recommendation</button>
                <button class="subtle-btn" id="nudge-break">Nudge micro-break</button>
                <div class="drawer-chip-row">
                  <span class="chip">Deep Work</span>
                  <span class="chip">Admin Sprint</span>
                  <span class="chip">Short Burst</span>
                </div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </section>

    <section class="stage" id="wrap">
      <div class="stage-heading">
        <div>
          <h2>Wrap</h2>
          <p>Close loops, honor wins, and set future-you up gently.</p>
        </div>
        <button class="hero-cta">Begin wrap ritual</button>
      </div>
      <div class="stage-grid">
        <article class="card soft wrap-card">
          <h3>Session Log</h3>
          <p>Capture just enough context so it’s easy to re-engage later.</p>
          <div class="wrap-inputs">
            <textarea placeholder="What moved forward? Any surprises?" rows="4"></textarea>
            <textarea placeholder="What support will future you appreciate?" rows="3"></textarea>
          </div>
        </article>
        <article class="card neutral wrap-card">
          <h3>Retrospective chips</h3>
          <p>Tag how the block felt to reveal trends across the week.</p>
          <div class="drawer-chip-row">
            <button class="chip">Flowy</button>
            <button class="chip">Resilient</button>
            <button class="chip">Heavy lift</button>
            <button class="chip">Blocked</button>
            <button class="chip">Needed backup</button>
          </div>
          <button class="subtle-btn">Review streaks</button>
        </article>
        <article class="card muted wrap-card">
          <h3>Next anchor</h3>
          <p>Commit to the first touch tomorrow so you avoid re-entry friction.</p>
          <div class="list">
            <div class="list-item">
              <div>
                <strong>Start with charting backlog</strong>
                <p>Use Focus Music &amp; Do Not Disturb toggles.</p>
              </div>
              <span class="chip">5 min ramp</span>
            </div>
          </div>
        </article>
      </div>
    </section>
  </div>

  <div class="quick-capture" aria-live="polite">
    <input id="quick-task" type="text" placeholder="Quick capture..." />
    <button id="quick-save">Save</button>
    <button class="expand" id="quick-expand" title="Expand details">⋯</button>
  </div>

  <footer class="grounding-footer" id="grounding-footer">
    <button class="hero" id="footer-meltdown">Meltdown Shield</button>
    <button id="footer-dnd">Do Not Disturb</button>
    <button id="footer-music">Focus Music</button>
    <button id="footer-sensory">Adjust Sensory</button>
    <button id="footer-reset">Doorway Reset</button>
  </footer>

  <div class="meltdown-overlay" id="meltdown-overlay" role="dialog" aria-modal="true" aria-labelledby="meltdown-title">
    <div class="meltdown-card">
      <h3 id="meltdown-title">Meltdown Shield</h3>
      <p>You’re safe. Ground with these micro-steps; the rest of the system will guard your schedule.</p>
      <ol class="meltdown-steps">
        <li>Press both feet into the floor · name five things you can see.</li>
        <li>Tap the “Support Ally” button—Jamie is already on call.</li>
        <li>Start the low-stim playlist · breathe in for four, out for six.</li>
      </ol>
      <div class="modal-actions">
        <button class="secondary" id="meltdown-close">I’m steady</button>
        <button class="primary">Message Ally</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="capture-modal" role="dialog" aria-modal="true" aria-labelledby="capture-title">
    <div class="modal-card">
      <div class="stepper">
        <span class="step step-1 active"></span>
        <span class="step step-2"></span>
      </div>
      <div class="modal-content" data-step="1">
        <h3 id="capture-title">Capture basics</h3>
        <input type="text" id="modal-title" placeholder="Task title" style="padding:0.85rem 1rem;border-radius:12px;border:1px solid rgba(148,163,184,0.2);background:rgba(8,12,20,0.9);color:var(--text-primary);" />
        <textarea id="modal-notes" rows="3" placeholder="Optional notes"></textarea>
      </div>
      <div class="modal-content hidden" data-step="2">
        <h3>Layer in context</h3>
        <select id="modal-context">
          <option>Focus block</option>
          <option>Admin sprint</option>
          <option>Deep work</option>
        </select>
        <textarea id="modal-support" rows="3" placeholder="Supports or dependencies"></textarea>
      </div>
      <div class="modal-actions">
        <button class="secondary" id="modal-back">Back</button>
        <button class="primary" id="modal-next">Next</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Task captured</div>

  <script>
    const stageTabs = document.querySelectorAll('.stage-tab');
    const stages = document.querySelectorAll('.stage');
    const quickInput = document.getElementById('quick-task');
    const quickSave = document.getElementById('quick-save');
    const quickExpand = document.getElementById('quick-expand');
    const toast = document.getElementById('toast');
    const captureModal = document.getElementById('capture-modal');
    const modalSteps = document.querySelectorAll('.modal-content');
    const stepIndicators = document.querySelectorAll('.stepper .step');
    const modalNext = document.getElementById('modal-next');
    const modalBack = document.getElementById('modal-back');
    const partnerToggle = document.querySelector('.toggle-partner');
    const partnerChips = document.querySelectorAll('.partner-chip');
    const hudDrawerToggle = document.querySelector('.hud-drawer-toggle');
    const hudDrawer = document.querySelector('.hud-drawer');
    const startFocus = document.getElementById('start-focus');
    const energySlider = document.getElementById('energy-slider');
    const timeSlider = document.getElementById('time-slider');
    const energyValue = document.getElementById('energy-value');
    const timeValue = document.getElementById('time-value');
    const hudRecommendation = document.getElementById('hud-recommendation');
    const hudContext = document.getElementById('hud-context');
    const refreshHud = document.getElementById('refresh-hud');
    const nudgeBreak = document.getElementById('nudge-break');
    const meltdownOverlay = document.getElementById('meltdown-overlay');
    const meltdownClose = document.getElementById('meltdown-close');
    const footerMeltdown = document.getElementById('footer-meltdown');
    const stageScroll = (id) => {
      const target = document.getElementById(id);
      if (target) {
        window.scrollTo({ top: target.offsetTop - 100, behavior: 'smooth' });
      }
    };

    stageTabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        stageTabs.forEach((btn) => btn.classList.remove('active'));
        tab.classList.add('active');
        stageScroll(tab.dataset.target);
      });
    });

    const togglePartners = () => {
      const expanded = partnerToggle.classList.toggle('open');
      document.querySelector('.partner-rail').setAttribute('aria-expanded', expanded);
      partnerToggle.querySelector('span').textContent = expanded ? 'Hide reassurance crew' : 'Show reassurance crew';
      partnerChips.forEach((chip, index) => {
        if (expanded) {
          setTimeout(() => chip.classList.add('visible'), index * 60);
        } else {
          chip.classList.remove('visible');
        }
      });
    };

    partnerToggle.addEventListener('click', togglePartners);

    let hudDrawerOpen = false;
    const toggleHudDrawer = () => {
      hudDrawerOpen = !hudDrawerOpen;
      hudDrawer.classList.toggle('open', hudDrawerOpen);
      hudDrawerToggle.setAttribute('aria-expanded', hudDrawerOpen);
      hudDrawer.setAttribute('aria-hidden', !hudDrawerOpen);
      hudDrawerToggle.textContent = hudDrawerOpen ? 'Close controls' : 'More controls';
    };
    hudDrawerToggle.addEventListener('click', toggleHudDrawer);

    const updateFocusCopy = () => {
      const energy = parseInt(energySlider.value, 10);
      const time = parseInt(timeSlider.value, 10);
      energyValue.textContent = `${energy}/10`;
      const minutes = Math.round((time / 10) * 90);
      timeValue.textContent = `${minutes} min`;
      if (energy >= 7 && minutes >= 45) {
        hudRecommendation.textContent = 'Prep tomorrow’s safety plans';
        hudContext.textContent = 'Your energy is trending solid and you have a healthy block—lean into proactive work while momentum is high.';
      } else if (energy <= 4) {
        hudRecommendation.textContent = 'Triage urgent follow-ups';
        hudContext.textContent = 'Keep it light: send the key messages, log quick notes, and schedule recovery time next.';
      } else {
        hudRecommendation.textContent = 'Advance the insurance report draft';
        hudContext.textContent = 'Use structured templates and checklists to maintain steady progress without extra cognitive load.';
      }
    };

    energySlider.addEventListener('input', updateFocusCopy);
    timeSlider.addEventListener('input', updateFocusCopy);

    let blockActive = false;
    startFocus.addEventListener('click', () => {
      blockActive = !blockActive;
      startFocus.textContent = blockActive ? 'Extend focus block' : 'Start focus block';
      startFocus.classList.toggle('extending', blockActive);
      toast.textContent = blockActive ? 'Focus block started' : 'Focus block logged';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2600);
    });

    refreshHud.addEventListener('click', () => {
      hudRecommendation.textContent = 'Check in on resilience toolkit';
      hudContext.textContent = 'Take 3 minutes to review your script cards so they are muscle memory mid-session.';
      toast.textContent = 'Recommendations refreshed';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2600);
    });

    nudgeBreak.addEventListener('click', () => {
      toast.textContent = 'Break scheduled in 10 minutes';
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2600);
    });

    const openModal = () => {
      captureModal.classList.add('open');
      document.body.style.overflow = 'hidden';
      setStep(1);
    };

    const closeModal = () => {
      captureModal.classList.remove('open');
      document.body.style.overflow = '';
    };

    let currentStep = 1;
    const setStep = (step) => {
      currentStep = step;
      modalSteps.forEach((panel) => {
        panel.classList.toggle('hidden', parseInt(panel.dataset.step, 10) !== currentStep);
      });
      stepIndicators.forEach((stepEl, index) => {
        stepEl.classList.toggle('active', index < currentStep);
      });
      modalBack.style.visibility = currentStep === 1 ? 'hidden' : 'visible';
      modalNext.textContent = currentStep === 2 ? 'Save Task' : 'Next';
    };

    modalBack.addEventListener('click', () => {
      if (currentStep > 1) {
        setStep(currentStep - 1);
      }
    });

    modalNext.addEventListener('click', () => {
      if (currentStep === 1) {
        setStep(2);
      } else {
        closeModal();
        toast.textContent = 'Task captured with context';
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2600);
      }
    });

    captureModal.addEventListener('click', (event) => {
      if (event.target === captureModal) {
        closeModal();
      }
    });

    quickExpand.addEventListener('click', openModal);

    quickSave.addEventListener('click', () => {
      if (!quickInput.value.trim()) {
        toast.textContent = 'Add a task title to save';
      } else {
        toast.textContent = `Captured: ${quickInput.value.trim()}`;
        quickInput.value = '';
      }
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2600);
    });

    const openMeltdown = () => {
      meltdownOverlay.classList.add('open');
      document.body.style.overflow = 'hidden';
    };

    const closeMeltdown = () => {
      meltdownOverlay.classList.remove('open');
      document.body.style.overflow = '';
    };

    footerMeltdown.addEventListener('click', openMeltdown);
    document.querySelector('[data-open="meltdown"]').addEventListener('click', openMeltdown);
    meltdownOverlay.addEventListener('click', (event) => {
      if (event.target === meltdownOverlay) {
        closeMeltdown();
      }
    });
    meltdownClose.addEventListener('click', closeMeltdown);

    document.querySelectorAll('[data-open="grounding"]').forEach((btn) => {
      btn.addEventListener('click', () => {
        stageScroll('prime');
        document.getElementById('grounding-footer').classList.add('pulse');
        setTimeout(() => document.getElementById('grounding-footer').classList.remove('pulse'), 1200);
      });
    });

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const id = entry.target.id;
            stageTabs.forEach((btn) => {
              btn.classList.toggle('active', btn.dataset.target === id);
            });
          }
        });
      },
      { rootMargin: '-50% 0px -40% 0px' }
    );

    stages.forEach((stage) => observer.observe(stage));

    updateFocusCopy();
    modalBack.style.visibility = 'hidden';
  </script>
</body>
</html>
